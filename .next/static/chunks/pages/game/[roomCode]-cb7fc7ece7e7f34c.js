(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{8988:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/[roomCode]",function(){return t(9380)}])},9380:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var l=t(7876),a=t(4232),r=t(9099),n=t(8473),i=t(4957),c=t(2598);let o={win:new c.Howl({src:["/sounds/win.mp3"]}),click:new c.Howl({src:["/sounds/click.mp3"]}),submit:new c.Howl({src:["/sounds/submit.mp3"]}),error:new c.Howl({src:["/sounds/error.mp3"]})},d=(0,i.vt)(()=>({playSound:e=>{let s=o[e];s&&s.play()}}));var m=t(4463),x=t(6153);let u=e=>{let{winner:s,curse:t,onClose:r}=e,n=d(e=>e.playSound);return(0,a.useEffect)(()=>{n("win");let e=setTimeout(r,5e3);return()=>clearTimeout(e)},[r,n]),(0,l.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:(0,l.jsx)("div",{className:"bg-gradient-to-b from-yellow-900/50 to-yellow-950/50 p-8 rounded-lg max-w-2xl w-full mx-4 border border-yellow-500/30 shadow-2xl",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"flex justify-center mb-4",children:(0,l.jsx)(m.A,{className:"h-12 w-12 text-yellow-400 animate-bounce"})}),(0,l.jsx)("h2",{className:"text-3xl font-bold text-yellow-400 mb-2",children:"Winning Curse!"}),(0,l.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-6",children:[(0,l.jsx)(x.A,{className:"h-5 w-5 text-yellow-400"}),(0,l.jsx)("p",{className:"text-xl text-yellow-200",children:s})]}),(0,l.jsx)("div",{className:"bg-yellow-900/30 p-6 rounded-lg border border-yellow-500/20 mb-6",children:(0,l.jsx)("p",{className:"text-xl italic text-white",children:t})}),(0,l.jsx)("p",{className:"text-yellow-200/60 text-sm",children:"Rotating judge in a moment..."})]})})})},h=()=>{let[e,s]=(0,a.useState)(""),[t,r]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!1),o=(0,n.T)(e=>e.roomData),x=(0,n.T)(e=>e.session),h=(0,n.T)(e=>e.pickWinner),b=d(e=>e.playSound);if(!o||!x.name)return null;let p=Object.entries(o.submissions).filter(e=>{let[s]=e;return s!==x.name}).map(e=>{let[s,t]=e;return{player:s,curse:t}}),j=async s=>{if(s.preventDefault(),e){r(!0);try{c(!0),b("win")}catch(e){console.error("Error picking winner:",e),r(!1)}}},g=async()=>{try{await h(e),s(""),c(!1)}finally{r(!1)}};return(0,l.jsxs)("div",{className:"p-4 md:p-6",children:[i&&(0,l.jsx)(u,{winner:e,curse:o.submissions[e],onClose:g}),(0,l.jsxs)("div",{className:"flex items-center mb-4",children:[(0,l.jsx)(m.A,{className:"text-yellow-400 mr-2"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-yellow-100",children:"Judge's Panel"})]}),(0,l.jsxs)("div",{className:"slight-card mb-8",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-2 text-indigo-200",children:"The Slight:"}),(0,l.jsx)("p",{className:"text-xl italic text-white",children:o.slight})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-200",children:0===p.length?"Waiting for submissions...":"Select the best curse:"}),p.length>0?(0,l.jsxs)("form",{onSubmit:j,children:[(0,l.jsx)("div",{className:"grid gap-3 mb-6",children:p.map((t,a)=>{let{player:r,curse:n}=t;return(0,l.jsx)("div",{className:"submission-card animate-pop cursor-pointer ".concat(e===r?"border-yellow-500 bg-yellow-900/40":""),onClick:()=>s(r),children:(0,l.jsxs)("label",{className:"flex items-start cursor-pointer",children:[(0,l.jsx)("input",{type:"radio",name:"winner",value:r,checked:e===r,onChange:()=>s(r),className:"mt-1 mr-3"}),(0,l.jsx)("span",{children:n})]})},a)})}),(0,l.jsx)("button",{type:"submit",className:"btn-success w-full md:w-auto",disabled:t||!e,children:t?"Selecting...":"Award Point"})]}):(0,l.jsx)("div",{className:"text-center p-8 italic text-gray-400",children:"Waiting for players to submit their curses..."})]})},b=()=>{let[e,s]=(0,a.useState)(""),[t,r]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!1),o=(0,n.T)(e=>e.session),m=(0,n.T)(e=>e.roomData),x=(0,n.T)(e=>e.submitCurse),u=(0,n.T)(e=>e.redrawHand),h=d(e=>e.playSound);if(!m||!o.name)return null;let b=m.hands[o.name]||[],p=!!m.submissions[o.name],j=async l=>{l.preventDefault(),c(!0);try{t?(await u(),s(""),r(!1),h("error")):e&&(await x(e),h("submit"))}catch(e){console.error("Error submitting:",e),h("error")}finally{c(!1)}};return p?(0,l.jsxs)("div",{className:"text-center p-8 animate-pulse",children:[(0,l.jsx)("h3",{className:"text-2xl mb-4",children:"Submission received!"}),(0,l.jsx)("p",{className:"text-gray-300 italic",children:"Waiting for other players and the judge's decision..."})]}):(0,l.jsxs)("div",{className:"p-4 md:p-6",children:[(0,l.jsxs)("div",{className:"slight-card mb-8",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-2 text-indigo-200",children:"The Slight:"}),(0,l.jsx)("p",{className:"text-xl italic text-white",children:m.slight})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Choose Your Curse:"}),(0,l.jsxs)("form",{onSubmit:j,children:[(0,l.jsx)("div",{className:"grid gap-3 mb-6",children:b.map((t,a)=>(0,l.jsx)("div",{className:"curse-card animate-pop cursor-pointer ".concat(e===t?"border-indigo-500 bg-gray-700":""),onClick:()=>{s(t),h("click")},children:(0,l.jsxs)("label",{className:"flex items-start cursor-pointer",children:[(0,l.jsx)("input",{type:"radio",name:"curse",value:t,checked:e===t,onChange:()=>s(t),className:"mt-1 mr-3"}),(0,l.jsx)("span",{children:t})]})},a))}),(0,l.jsxs)("div",{className:"flex items-center mb-6",children:[(0,l.jsx)("input",{type:"checkbox",id:"redraw",checked:t,onChange:e=>r(e.target.checked),className:"mr-3"}),(0,l.jsx)("label",{htmlFor:"redraw",className:"text-gray-300",children:"Redraw my hand (skip this round)"})]}),(0,l.jsx)("button",{type:"submit",className:"btn-primary w-full md:w-auto",disabled:i||!e&&!t,children:i?"Submitting...":t?"Redraw Hand":"Submit Curse"})]})]})},p=()=>{let{roomCode:e}=(0,r.useRouter)().query,s=(0,n.T)(e=>e.roomData),t=(0,n.T)(e=>e.session),i=(0,n.T)(e=>e.loadRoomData);if((0,a.useEffect)(()=>{e&&"string"==typeof e&&(console.log("[GamePage] Loading room:",e),i(e).catch(e=>{console.error("[GamePage] Failed to load room:",e)}))},[e,i]),!s||!t.name)return(0,l.jsxs)("div",{className:"text-center p-10",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-red-400",children:"Unable to load game."}),(0,l.jsx)("p",{className:"text-gray-300 mt-2",children:"Please return to the home page and try again."})]});let c=s.judge===t.name;return(0,l.jsxs)("div",{className:"p-4 md:p-8",children:[(0,l.jsxs)("h1",{className:"text-3xl font-bold text-center mb-6",children:["Room: ",t.room]}),(0,l.jsxs)("p",{className:"text-center text-gray-400 mb-4",children:["You are the ",c?"Judge":"Player"]}),c?(0,l.jsx)(h,{}):(0,l.jsx)(b,{})]})};function j(){let e=(0,r.useRouter)().query.roomCode;return((0,a.useEffect)(()=>{e||console.warn("Room code is undefined â€” routing delay or invalid URL")},[e]),e)?(0,l.jsx)("div",{className:"min-h-screen bg-gray-900 text-white font-sans",children:(0,l.jsx)(p,{})}):(0,l.jsxs)("div",{className:"text-center p-10 text-white",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-yellow-400",children:"Loading room..."}),(0,l.jsx)("p",{className:"text-gray-300 mt-2",children:"Please wait while we connect."})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[276,473,636,593,792],()=>s(8988)),_N_E=e.O()}]);