"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[473],{8473:(o,e,t)=>{t.d(e,{T:()=>u});var a=t(4957);async function r(o,e){console.log("[client-redis.ts] Calling API to set key: ".concat(o));let t=await fetch("/api/kv/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:o,value:e})});if(!t.ok){let e={error:"API error setting key ".concat(o,": ").concat(t.status," ").concat(t.statusText)};try{e=await t.json()}catch(e){console.error("[client-redis.ts] API error (could not parse JSON response) setting key ".concat(o,". Status: ").concat(t.status))}throw console.error("[client-redis.ts] API error setting key ".concat(o,". Full Response Status: ").concat(t.status," ").concat(t.statusText),e),Error(e.error||"API error: ".concat(t.status))}console.log("[client-redis.ts] API call to set key ".concat(o," was successful (status ").concat(t.status,")."))}async function n(o){var e;console.log("[client-redis.ts] Calling API to get key: ".concat(o));let t=await fetch("/api/kv/get?key=".concat(encodeURIComponent(o)));if(!t.ok){let e={error:"API error getting key ".concat(o,": ").concat(t.status," ").concat(t.statusText)};try{e=await t.json()}catch(e){console.error("[client-redis.ts] API error (could not parse JSON response) getting key ".concat(o,". Status: ").concat(t.status))}return console.error("[client-redis.ts] API error getting key ".concat(o,". Full Response Status: ").concat(t.status," ").concat(t.statusText),e),null}return null!=(e=(await t.json()).result)?e:null}async function s(o){console.log("[client-redis.ts] Calling API to delete key: ".concat(o));let e=await fetch("/api/kv/del",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:o})});if(!e.ok){let t={error:"API error deleting key ".concat(o,": ").concat(e.status," ").concat(e.statusText)};try{t=await e.json()}catch(t){console.error("[client-redis.ts] API error (could not parse JSON response) deleting key ".concat(o,". Status: ").concat(e.status))}throw console.error("[client-redis.ts] API error deleting key ".concat(o,". Full Response Status: ").concat(e.status," ").concat(e.statusText),t),Error(t.error||"API error: ".concat(e.status))}}let i=["I didn’t use my turn signal when changing lanes.","I listened to my music on a Bluetooth speaker in public.","I put an empty milk jug in the fridge.","I sent a ‘just checking in!’ text but never replied when they answered.","I cut across two lanes to catch my exit at the last second.","I left a single sheet of toilet paper on the roll instead of replacing it.","I farted in a sealed elevator.","I talked through the entire movie, but only during the important parts.","I puff puffed but didn’t pass.","I took my shoes off on a plane and put my bare feet on the seat in front of me.","My phone went off during a funeral.","I chewed with my mouth open while making direct eye contact.","I wore way too much perfume or cologne.","I FaceTimed someone in a public restroom.","I blocked traffic for a TikTok video.","I clapped when the plane landed.","I cooked my steak well done.","I left my shopping cart in the middle of the parking lot.","I blamed the cat for something I did.","I aggressively shook someone’s hand even though they clearly had a drink in the other hand.","I used up all the hot water.","I kept hitting snooze on my alarm, waking everyone up every 5 minutes.",'I start every sentence with "Honestly..."',"I took a bite of someone’s food without asking.","I asked for some food after saying I wasn’t hungry.","I left my phone on full volume in a quiet place and didn’t answer it.","I still have Crazy Frog as my ringtone.","I got drunk at my kid’s T-ball game.",'I started a conversation about cupcakes with "We need to talk."',"I played on my phone when someone was waiting for the bathroom.","I left my wet laundry in the machine for hours, blocking everyone else from using it.","I write LOL after every joke. LOL.","I only talk about myself.","I loudly cracked my knuckles in a silent room.","I drove slowly in the fast lane.",'I took forever to text back, then just responded "lol."',"I backwashed in someone’s drink.","I left a passive-aggressive sticky note instead of just talking to someone.","I double dipped.","I stopped to text in the middle of a busy sidewalk.","I got drunk at my work party.",'I said "just a minute" six hours ago.',"I took the biggest piece of cake without asking.","I ruined a surprise party.","I left the loaf of bread open.","I took the batteries out of the remote and didn’t put them back.",'I gave the most generic advice... "stay in bed and drink plenty of fluids."',"I left my car parked across two spaces.","I left my bright lights on while driving.","I took my socks off and left them in the living room."],y=["May your shower always be just slightly too cold.","May your phone charger only work at a weird angle.","May you always get a popcorn kernel stuck in your teeth.","May you always feel like you forgot something, but you didn’t.","May you always hear a cricket but never find it.","May every TV show you love get canceled after one season.","May your socks always be slightly damp.","May you always type ‘teh’ instead of ‘the.’","May every show you watch have spoilers in the thumbnails.","May your pillow always be warm.","May your earbuds always be tangled no matter how carefully you put them away.","May your fitted sheet always pop off the corner of your bed.","May your coffee never be just the right temperature.","May every shopping cart you grab have a wobbly wheel.","May you always sneeze four times in a row.","May your phone screen always be just a little too dim.","May you always lose your chapstick immediately after buying it.","May your ice cream always be too melted or too frozen—never in between.","May every time you try to fast forward, you accidentally restart the show instead.","May you always drop a nickel when looking for change.","May your sneakers always squeak.","May every time you crack your knuckles, only one finger pops.","May you always spray your hotdog with mustard juice.","May your debit card always take two swipes to work.","May your allergies kick in out of season.","May your Bluetooth randomly disconnect for no reason.","May your car break down in a field full of fleas.","May your glasses always have a tiny smudge you can’t find.","May your smoke alarm drain all your batteries CHIRP.","May every door knob you touch give you a static shock.","May your voice crack whenever you get mad.","May every red light last exactly one second longer just for you.","May you never turn right on red.","May you always have a high ping.","May your shoelaces always come untied at the worst possible moment.","May you overtip by 10%.","Every time you use a pen, may it run out of ink halfway through writing something important.","May you never have the right condiments.","May your phone battery percentage lie to you.","May you do THAT for love.","May every time you go to take a sip, your cup is just a little emptier than you expected.","May your pinky toe always poke through your sock.","May your grocery bag always rip at the worst possible moment.","May you never find ripe avocados.","May your belt loops always get caught on doorknobs.","May you stumble on things that aren’t there.","May your ice maker always give you one cube less than you need.","May your grilled cheese melt unevenly.","May you spill a few drops of coffee on yourself before an important meeting.","May you always get stuck behind someone walking painfully slow.","May you always end up behind a school bus when you’re running late.","May your check engine light always be on.","May your fork always have one bent prong.","May your playlist always shuffle to the songs you skip.","May your toilet seat always be cold.","May every time you sit in a swivel chair, it leans back just a little too far.","May people mistake your love for pineapples as something else.","May nothing important happen to you today.","May you tear up every time you yawn.","May the next joke you hear go over your head.","May someone steal your bandwidth.","May your Hot Pocket… done and done.","May you have a 4K TV and a 720p DVD.","May a friend find something embarrassing in your couch.","May you get a fairytale ending.","May your DoorDash driver be creepy.","May you be creative with writer's block.","May you catch a hangnail on a piece of fabric.","May you always have the wrong A-size battery.","May your seatbelt lock.","May you need to blow your nose and don’t have tissues.","May your dry erase markers leave a smudge.","May your favorite mug always have just a little bit of coffee residue left in it.","May your phone always slip just out of reach when you're lying down.","May your autocorrect never learn your name.","May your Wi-Fi signal drop right as you’re about to win an online argument.","May your favorite sweater always smell faintly of someone else’s perfume.","May your fridge make that weird humming noise only when you’re trying to sleep.","May your favorite snack always be just expired when you grab it.","May your alarm clock snooze button stop working when you need it most.","May your straw always bend at the wrong angle and stab your lip.","May your headphones only play sound in one ear until you jiggle the cord just right.","May every book you read have the last page torn out.","May your car radio only pick up static on your favorite station.","May your mouse cursor freeze for three seconds every time you click.","May your toast always be burnt.","May your umbrella flip inside out at the slightest breeze.","May your favorite pen leak just enough ink to ruin one important note.","May every pair of jeans you own get a tiny hole in the crotch.","May your microwave popcorn always have twice as many unpopped kernels.","May your chair always wobble just enough to annoy you but not enough to fix.","May your pizza delivery always forget the extra sauce you paid for.","May your shampoo bottle always fall over in the shower when it’s almost empty.","May your favorite shirt shrink just enough to feel tight but not enough to replace.","May your weather app always predict the sun right before it pours.","May your socks always slide down inside your shoes halfway through the day.","May your printer jam every time you’re in a hurry.","May your keyboard miss exactly one letter every time you type a password.","May your favorite candle burn out after five minutes every time you light it.","May your streaming service buffer only during the best part of the movie."];function c(o){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return[...o].sort(()=>Math.random()-.5).slice(0,e)}function l(o){return o[Math.floor(Math.random()*o.length)]}let u=(0,a.vt)((o,e)=>({session:{name:"",room:null},setSession:e=>o(o=>({session:{...o.session,...e}})),roomData:null,loadRoomData:async t=>{console.log("[store.ts] loadRoomData: Loading room ".concat(t));try{let[a,r,s,i,y]=await Promise.all([n("room:".concat(t,":judge")),n("room:".concat(t,":players")),n("room:".concat(t,":scores")),n("room:".concat(t,":round")),n("room:".concat(t,":slight"))]);if(console.log("[store.ts] loadRoomData - Fetched from KV:",{judge:a,playersJson:r,scoresJson:s,round:i,slight:y}),!a||!r||!s||!i||!y)throw console.error("[store.ts] loadRoomData: Incomplete room data for ".concat(t)),Error("Incomplete room data");let c=JSON.parse(r),l=JSON.parse(s),u={};await Promise.all(c.map(async o=>{let e=await n("room:".concat(t,":submission:").concat(o));e&&(u[o]=e)}));let m=e().session.name,d={};if(m){let o=await n("room:".concat(t,":hand:").concat(m));o&&(d[m]=JSON.parse(o))}o({roomData:{judge:a,players:c,scores:l,round:parseInt(i),slight:y,submissions:u,hands:d}}),console.log("[store.ts] loadRoomData: Room ".concat(t," data set in store."))}catch(e){throw console.error("[store.ts] loadRoomData: Failed for room ".concat(t,":"),e),o({roomData:null}),e}},createRoom:async(t,a)=>{let n=t.toUpperCase();console.log("[store.ts] createRoom: Attempting for room ".concat(n,", alias ").concat(a));try{await r("room:".concat(n,":judge"),a),await r("room:".concat(n,":players"),JSON.stringify([a])),await r("room:".concat(n,":scores"),JSON.stringify({[a]:0})),await r("room:".concat(n,":round"),"1"),await r("room:".concat(n,":slight"),l(i)),await r("room:".concat(n,":hand:").concat(a),JSON.stringify(c(y))),console.log("[store.ts] createRoom: All KV operations complete for room ".concat(n)),o({session:{name:a,room:n}}),await e().loadRoomData(n)}catch(o){throw console.error("[store.ts] createRoom: Error for room ".concat(n,":"),o),o}},joinRoom:async(t,a)=>{let s=t.toUpperCase();console.log("[store.ts] joinRoom: Attempting for room ".concat(s,", alias ").concat(a));try{let[t,i]=await Promise.all([n("room:".concat(s,":players")),n("room:".concat(s,":scores"))]);if(console.log("[store.ts] joinRoom - Fetched from KV:",{playersJson:t,scoresJson:i}),!t||!i)throw console.error("[store.ts] joinRoom: Room ".concat(s," not found or data incomplete.")),Error("Room not found");let l=JSON.parse(t),u=JSON.parse(i);l.includes(a)||(l.push(a),u[a]=0,await r("room:".concat(s,":players"),JSON.stringify(l)),await r("room:".concat(s,":scores"),JSON.stringify(u)),await r("room:".concat(s,":hand:").concat(a),JSON.stringify(c(y)))),console.log("[store.ts] joinRoom: Successfully processed join for ".concat(a," in room ").concat(s)),o({session:{name:a,room:s}}),await e().loadRoomData(s)}catch(o){throw console.error("[store.ts] joinRoom: Error for room ".concat(s," with alias ").concat(a,":"),o),o}},submitCurse:async o=>{let{session:t,loadRoomData:a,playSound:n}=e();if(t.room&&t.name){console.log("[store.ts] submitCurse: ".concat(t.name," submitting '").concat(o,"' for room ").concat(t.room));try{await r("room:".concat(t.room,":submission:").concat(t.name),o),await a(t.room),n("submit")}catch(o){throw console.error("[store.ts] submitCurse: Error for ".concat(t.name," in room ").concat(t.room,":"),o),o}}},redrawHand:async()=>{let{session:o,loadRoomData:t}=e();if(o.room&&o.name){console.log("[store.ts] redrawHand: ".concat(o.name," redrawing hand for room ").concat(o.room));try{await r("room:".concat(o.room,":hand:").concat(o.name),JSON.stringify(c(y))),await t(o.room)}catch(e){throw console.error("[store.ts] redrawHand: Error for ".concat(o.name," in room ").concat(o.room,":"),e),e}}},pickWinner:async o=>{let{session:t,roomData:a,loadRoomData:n,playSound:y}=e();if(t.room&&a&&t.name){console.log("[store.ts] pickWinner: Judge ".concat(t.name," picking ").concat(o," in room ").concat(t.room));try{let e={...a.scores};e[o]=(e[o]||0)+1,await Promise.all([r("room:".concat(t.room,":scores"),JSON.stringify(e)),r("room:".concat(t.room,":round"),"".concat(a.round+1)),r("room:".concat(t.room,":slight"),l(i)),r("room:".concat(t.room,":judge"),function(o,e){let t=o.indexOf(e);return o[(t+1)%o.length]}(a.players,a.judge)),...a.players.map(o=>s("room:".concat(t.room,":submission:").concat(o)))]),y("win"),await n(t.room)}catch(o){throw console.error("[store.ts] pickWinner: Error in room ".concat(t.room,":"),o),o}}},playSound:o=>{if("undefined"!=typeof document){let e=document.getElementById("".concat(o,"Sound"));e?(e.currentTime=0,e.play().catch(o=>console.error("Error playing sound:",o))):console.warn("[store.ts] playSound: Audio element '".concat(o,"Sound' not found."))}else console.warn("[store.ts] playSound: Attempted to play sound in non-browser environment.")}}))}}]);